# ----------- 00 task:
# run 'py exploit.py'  to create 'evilcorp_hacked.html' file
# then 'py -m http.server'
# then in browser 'http://127.0.0.1:8000/evilcorp_hacked.html'

'''
Beautiful Soup — это библиотека Python для извлечения данных из файлов HTML и XML.
<title>Evil Corp - Money Transfer</title>
'''
from bs4 import BeautifulSoup

# 1
with open('../materials/evilcorp.html', 'r') as file:
    content = file.read()

soup = BeautifulSoup(content, 'html.parser')

# 2
soup.title.string = 'Evil Corp - Stealing your money every day'

# 3
# find text
# находит первый тег <span> с классом pronoun в HTML-документе.
# удаляет пробельные символы (пробелы, табуляции, переводы строк)
# с начала и конца строки
pronoun = soup.find('span', class_='pronoun').text.strip()
# name = soup.find('span', class_='name').text.strip().replace(pronoun, '')
name1 = soup.find('span', class_='name').text.strip()

new_tag = soup.new_tag('h1')
# new_tag.string = f'{pronoun} {name}, you are hacked!'
new_tag.string = f'{name1}, you are hacked!'
soup.body.append(new_tag)

# 4
# add script to body
script_content = '''
hacked = function() {
    alert('hacked');
}
window.addEventListener('load', 
  function() { 
    var f = document.querySelector("form");
    f.setAttribute("onsubmit", "hacked()");
  },
  false
);
'''
# Create the <script> tag
script_tag = soup.new_tag('script')
script_tag.string = script_content

# add to html body
soup.body.append(script_tag)

# 5
# find tag 'a' and change link 
link = soup.find('a')
link.attrs['href'] = 'https://mrrobot.fandom.com/wiki/Fsociety'
# link.string = 'Together we can change the world, with Fsociety'
if link.string == 'Evil Corp':
    link.string = 'Fsociety'

# write into new file
with open('../materials/evilcorp_hacked.html', 'w') as file:
    file.write(str(soup.prettify()))


# if __name__ == "__main__":
#     print(pronoun)
#     print(name1)
